<!DOCTYPE html>
<html>
<head>    
    <meta charset="UTF-8">
    <title>Каталог</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .category-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 16px;
        }
        .category-item, .product-card {
            text-align: center;
            background: #fff;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        .category-item img, .product-card img {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }
        .product-detail {
            padding: 16px;
        }
        .back-button {
            margin: 10px;
            display: inline-block;
            cursor: pointer;
            color: blue;
        }
        .add-button {
            margin-top: 10px;
            background-color: #ddd;
            padding: 8px 12px;
            border-radius: 6px;
            display: inline-block;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="/static/logo22.png" alt="Логотип" class="logo">
    </div>

    <div id="content" class="menu-vertical"></div>

    <div class="footer-buttons">
        <div id="home-button" onclick="window.location.href='/'">
            <img src="/static/home.svg" alt="Домой">
        </div>
        <div id="login-button">
            <img src="/static/login.svg" alt="Авторизация">
        </div>
    </div>

    <script>
        const content = document.getElementById('content');

        const rootCategories = [
            { id: "vape", name: "Парогенераторы", icon: "vape.png" },
            { id: "juice", name: "Жидкости для вейпа", icon: "juice.png" },
            { id: "parts", name: "Запчасти и комплектующие", icon: "spanner.png" },
            { id: "hookah", name: "Кальяны и комплектующие", icon: "hookah.png" },
            { id: "diy", name: "Самозамес", icon: "test.png" },
            { id: "sale", name: "Уценённый товар", icon: "sale.png" }
        ];

        function showCategories() {
            content.innerHTML = '<div class="category-grid">' +
                rootCategories.map(cat => `
                    <div class="category-item" onclick="loadCategory('${cat.name}')">
                        <img src="/static/icons/${cat.icon}" alt="${cat.name}">
                        <div>${cat.name}</div>
                    </div>
                `).join('') +
                '</div>';
        }

        async function loadCategory(name) {
            const res = await fetch('/api/catalog');
            const data = await res.json();

            const entry = Object.values(data).find(c => c.name === name);
            if (!entry) return showCategories();

            if (entry.products.length > 0) {
                showProducts(entry.products, name);
            } else {
                content.innerHTML = `<div class="back-button" onclick="showCategories()">← Назад</div><p>Нет товаров в категории.</p>`;
            }
        }

        function showProducts(products, categoryName) {
            content.innerHTML = `<div class="back-button" onclick="showCategories()">← Назад</div><div class="category-grid">` +
                products.map(p => `
                    <div class="product-card" onclick="showProductDetail(${encodeURIComponent(JSON.stringify(p))})">
                        <img src="${p.image}" alt="${p.title}">
                        <div>${p.title}</div>
                        <div class="add-button" onclick="event.stopPropagation(); alert('Смотреть можно, трогать нельзя!')">Добавить в корзину</div>
                    </div>
                `).join('') +
                '</div>';
        }

        function showProductDetail(encodedProduct) {
            const p = JSON.parse(decodeURIComponent(encodedProduct));
            content.innerHTML = `
                <div class="back-button" onclick="showCategories()">← Назад</div>
                <div class="product-detail">
                    <img src="${p.image}" style="width:100%; max-width:300px;" alt="${p.title}">
                    <h3>${p.title}</h3>
                    <p>${p.description}</p>
                    <div class="add-button" onclick="alert('Смотреть можно, трогать нельзя!')">Добавить в корзину</div>
                </div>
            `;
        }

        showCategories();
    </script>
</body>
</html>
