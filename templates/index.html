<!DOCTYPE html>
<html>
<head>
    <title>Мини-приложение</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="header">
        <img src="/static/logo22.png" alt="Логотип" class="logo">
    </div>

    <div class="menu-vertical">
        <button onclick="showSection('addresses')">Адреса магазинов</button>
        <button onclick="showSection('catalog')">Каталог товаров</button>
        <button onclick="showSection('review')">Оставить отзыв</button>
        <button onclick="showSection('contacts')">Контакты</button>
        <button onclick="showSection('jobs')">Вакансии</button>
        <button onclick="showSection('promotions')">Акции</button>
    </div>


    <!-- Первый блок: Кнопки домой и вход -->
    <div class="footer-buttons">
    <button id="home-button" onclick="goHome()">
        <img src="/static/home.svg" alt="Домой">
    </button>
    <button id="login-button" onclick="auth()">
        <img src="/static/login.svg" alt="Авторизация">
    </button>
    </div>

    <!-- Второй блок: Кнопка корзины -->
    <div class="cart-button-container">
        <button onclick="openCart()" class="cart-button">
            <img src="/static/shop.svg" alt="Корзина">
        </button>
    </div>

    <script>
        // Проверка initData
        if (!window.Telegram?.WebApp) {
            document.body.innerHTML = "Ошибка: откройте через Telegram!";
        }

        // Функция для загрузки данных
        async function loadData(url) {
            try {
                const response = await fetch(`/api/${url}`);
                if (!response.ok) throw new Error("Ошибка загрузки данных");
                return await response.json();
            } catch (error) {
                console.error(error);
                return null;
            }
        }
        // Показать список областей
        // Функция для загрузки данных
        async function loadData(url) {
            try {
                const response = await fetch(`/api/${url}`);
                if (!response.ok) throw new Error("Ошибка загрузки данных");
                return await response.json();
            } catch (error) {
                console.error(error);
                return null;
            }
        }

        // Показать список областей
        async function showRegions() {
            currentState = "regions";
            const regions = await loadData('regions');
            if (regions) {
                const buttons = regions.map(region => `
                    <button onclick="showCities('${region}')">${region}</button>
                `).join('');
                showContent(`<h3>Выберите область:</h3>${buttons}`);
            }
        }

        // Показать список городов
        async function showCities(region) {
            currentState = "cities";
            currentRegion = region;
            const cities = await loadData(`cities/${region}`);
            if (cities) {
                const buttons = cities.map(city => `
                    <button onclick="showStores('${city}', '${region}')">${city}</button>
                `).join('');
                showContent(`<h3>Выберите город в области "${region}":</h3>${buttons}`);
            }
        }

        // Показать список магазинов
        async function showStores(city, region) {
            currentState = "stores";
            currentCity = city;
            const stores = await loadData(`stores/${region}/${city}`);
            if (stores) {
                const buttons = stores.map(store => `
                    <button onclick="showStoreDetails('${store.name}')">${store.name}</button>
                `).join('');
                showContent(`<h3>Магазины в городе "${city}":</h3>${buttons}`);
            }
        }

        // Показать детали магазина
        async function showStoreDetails(storeName) {
            currentState = "storeDetails";
            const stores = await loadData(`stores/${currentRegion}/${currentCity}`);
            const store = stores.find(s => s.name === storeName);
            if (store) {
                showContent(`
                    <h3>${store.name}</h3>
                    <p><strong>Адрес:</strong> ${store.address}</p>
                    <p><strong>Режим работы:</strong> ${store.hours}</p>
                    <button onclick="window.open('${store.map_url}', '_blank')">Посмотреть на карте</button>
                `);
            }
        }
        // Логика для нижнего меню
        function goHome() {
            window.Telegram.WebApp.close(); // Закрыть приложение
        }

        function openCart() {
            alert("Функция корзины в разработке!");
        }

        function auth() {
            alert("Функция авторизации в разработке!");
        }
    </script>
</body>
</html>
