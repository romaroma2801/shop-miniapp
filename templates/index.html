<!DOCTYPE html>
<html>
<head>
    <title>Мини-приложение</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="header">
    <!-- Кнопка "Назад" -->
    <button id="back-button" onclick="goBack()" style="display: none;">
        <img src="/static/back.svg" alt="Назад">
    </button>
    <img src="/static/logo22.png" alt="Логотип" class="logo">
</div>

    <!-- Блок для динамического контента -->
    <div class="menu-vertical" id="content">
        <!-- Главное меню -->
        <button onclick="showRegions()">Адреса магазинов</button>
        <button onclick="showSection('catalog')">Каталог товаров</button>
        <button onclick="showSection('review')">Оставить отзыв</button>
        <button onclick="showSection('contacts')">Контакты</button>
        <button onclick="showSection('jobs')">Вакансии</button>
        <button onclick="showSection('promotions')">Акции</button>
    </div>

    <!-- Первый блок: Кнопки домой и вход -->
    <div class="footer-buttons">
        <button onclick="goHome()">
            <img src="/static/home.svg" alt="Домой">
        </button>
        <button onclick="auth()">
            <img src="/static/login.svg" alt="Авторизация">
        </button>
    </div>

    <!-- Второй блок: Кнопка корзины -->
    <div class="cart-button-container">
        <button onclick="openCart()" class="cart-button">
            <img src="/static/shop.svg" alt="Корзина">
        </button>
    </div>

    <script>
            // Проверка initData
        if (!window.Telegram?.WebApp) {
            document.body.innerHTML = "Ошибка: откройте через Telegram!";
        }

        // Глобальные переменные
        let currentState = "home";
        let currentRegion = null;
        let currentCity = null;

        // Функция для загрузки данных
        async function loadData(url) {
            try {
                const response = await fetch(`/api/${url}`);
                if (!response.ok) throw new Error("Ошибка загрузки данных");
                return await response.json();
            } catch (error) {
                console.error(error);
                return null;
            }
        }

        // Функция для отображения контента с анимацией
        function showContent(content) {
            const contentDiv = document.getElementById('content');
        
            // Добавляем анимацию исчезновения
            contentDiv.classList.add('hidden');
        
            setTimeout(() => {
                contentDiv.innerHTML = content;
            
                // Добавляем анимацию появления
                setTimeout(() => {
                    contentDiv.classList.remove('hidden');
                }, 50);
            }, 500);
        }

        // Функция для кнопки "Назад"
        function goBack() {
            const backButton = document.getElementById('back-button');
        
            // Анимация исчезновения кнопки "Назад"
            backButton.classList.remove('show');
        
            setTimeout(() => {
                backButton.style.display = 'none';
            }, 500);

            // Возвращаемся на предыдущий шаг
            if (currentState === "regions") {
                showHome();
            } else if (currentState === "cities") {
                showRegions();
            } else if (currentState === "stores") {
                showCities(currentRegion);
            } else if (currentState === "storeDetails") {
                showStores(currentCity, currentRegion);
            }
        }

        // Показать главное меню
        function showHome() {
            currentState = "home";
            document.getElementById('back-button').style.display = 'none';
            showContent(`
                <button onclick="showRegions()">Адреса магазинов</button>
                <button onclick="showSection('catalog')">Каталог товаров</button>
                <button onclick="showSection('review')">Оставить отзыв</button>
                <button onclick="showSection('contacts')">Контакты</button>
                <button onclick="showSection('jobs')">Вакансии</button>
                <button onclick="showSection('promotions')">Акции</button>
            `);
        }

        // Показать список областей
        async function showRegions() {
            currentState = "regions";
            const backButton = document.getElementById('back-button');
            backButton.style.display = 'block';
        
            // Анимация появления кнопки "Назад"
            setTimeout(() => {
                backButton.classList.add('show');
            }, 50);

            const regions = await loadData('regions');
            if (regions) {
                const buttons = regions.map(region => `
                    <button onclick="showCities('${region}')">${region}</button>
                `).join('');
                showContent(`<h3>Выберите область:</h3>${buttons}`);
            }
        }

        // Показать список городов
        async function showCities(region) {
            currentState = "cities";
            currentRegion = region;
            const cities = await loadData(`cities/${region}`);
            if (cities) {
                const buttons = cities.map(city => `
                    <button onclick="showStores('${city}', '${region}')">${city}</button>
                `).join('');
                showContent(`<h3>Города в области "${region}":</h3>${buttons}`);
            }
        }

        // Показать список магазинов
        async function showStores(city, region) {
            currentState = "stores";
            currentCity = city;
            const stores = await loadData(`stores/${region}/${city}`);
            if (stores) {
                const buttons = stores.map(store => `
                    <button onclick="showStoreDetails('${store.name}')">${store.name}</button>
                `).join('');
                showContent(`<h3>Магазины в городе "${city}":</h3>${buttons}`);
            }
        }

        // Показать детали магазина
        async function showStoreDetails(storeName) {
            currentState = "storeDetails";
            const stores = await loadData(`stores/${currentRegion}/${currentCity}`);
            const store = stores.find(s => s.name === storeName);
            if (store) {
                showContent(`
                    <h3>${store.name}</h3>
                    <p><strong>Адрес:</strong> ${store.address}</p>
                    <p><strong>Режим работы:</strong> ${store.hours.replace(/\n/g, '<br>')}</p>
                    <button onclick="window.open('${store.map_url}', '_blank')">Посмотреть на карте</button>
                `);
            }
        }

        // Логика для нижнего меню
        function goHome() {
            showHome(); // Переход на главное меню
        }

        function auth() {
            alert("Функция авторизации в разработке!");
        }

        function openCart() {
            alert("Функция корзины в разработке!");
        }

        // Дополнительная функция для показа других разделов
        function showSection(section) {
            alert(`Раздел "${section}" в разработке!`);
        }
    </script>
</body>
</html>
