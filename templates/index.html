<!DOCTYPE html>
<html>
<head>
    <title>Мини-приложение</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="header">
        <img src="/static/logo22.png" alt="Логотип" class="logo">
    </div>

    <div class="menu-vertical">
        <button onclick="showSection('addresses')">Адреса магазинов</button>
        <button onclick="showSection('catalog')">Каталог товаров</button>
        <button onclick="showSection('review')">Оставить отзыв</button>
        <button onclick="showSection('contacts')">Контакты</button>
        <button onclick="showSection('jobs')">Вакансии</button>
        <button onclick="showSection('promotions')">Акции</button>
    </div>

    <div class="content" id="content">
        <p>Выберите раздел...</p>
    </div>

    <div class="footer">
        <button onclick="goHome()">
            <img src="/static/home.svg" alt="Домой">
            <span>Главная</span>
        </button>
        <button onclick="openCart()">
            <img src="/static/shop.svg" alt="Корзина">
            <span>Корзина</span>
        </button>
        <button onclick="auth()">
            <img src="/static/login.svg" alt="Авторизация">
            <span>Авторизация</span>
        </button>
    </div>

    <script>
        // Проверка initData
        if (!window.Telegram?.WebApp) {
            document.body.innerHTML = "Ошибка: откройте через Telegram!";
        }

        // Функция для загрузки данных
        async function loadData(url) {
            try {
                const response = await fetch(`/api/${url}`);
                if (!response.ok) throw new Error("Ошибка загрузки данных");
                return await response.json();
            } catch (error) {
                console.error(error);
                return null;
            }
        }

        // Основная логика отображения разделов
        async function showSection(section) {
            const content = document.getElementById('content');
            content.innerHTML = "<p>Загрузка...</p>";

            switch(section) {
                case 'addresses':
                    const regions = await loadData('regions');
                    if (regions) {
                        content.innerHTML = `
                            <h3>Выберите область:</h3>
                            <select id="region-select" onchange="loadCities()">
                                <option value="">-- Выберите область --</option>
                                ${regions.map(r => `<option value="${r}">${r}</option>`).join('')}
                            </select>
                        `;
                    }
                    break;
                default:
                    content.innerHTML = `<p>Раздел "${section}" в разработке</p>`;
            }
        }

        // Загрузка городов по выбранной области
        async function loadCities() {
            const regionSelect = document.getElementById('region-select');
            const region = regionSelect.value;

            if (!region) return;

            const cities = await loadData(`cities/${region}`);
            const content = document.getElementById('content');

            if (cities) {
                content.innerHTML += `
                    <h4>Выберите город:</h4>
                    <select id="city-select" onchange="loadStores('${region}')">
                        <option value="">-- Выберите город --</option>
                        ${cities.map(c => `<option value="${c}">${c}</option>`).join('')}
                    </select>
                `;
            }
        }

        // Загрузка магазинов по выбранному городу
        async function loadStores(region) {
            const citySelect = document.getElementById('city-select');
            const city = citySelect.value;

            if (!city) return;

            const stores = await loadData(`stores/${region}/${city}`);
            const content = document.getElementById('content');

            if (stores) {
                content.innerHTML += `
                    <h5>Магазины:</h5>
                    <ul>
                        ${stores.map(s => `
                            <li>
                                <strong>${s.name}</strong><br>
                                Адрес: ${s.address}<br>
                                Режим работы: ${s.hours}<br>
                                <a href="${s.map_url}" target="_blank">Посмотреть на карте</a>
                            </li>
                        `).join('')}
                    </ul>
                `;
            }
        }

        // Логика для нижнего меню
        function goHome() {
            window.Telegram.WebApp.close(); // Закрыть приложение
        }

        function openCart() {
            alert("Функция корзины в разработке!");
        }

        function auth() {
            alert("Функция авторизации в разработке!");
        }
    </script>
</body>
</html>
