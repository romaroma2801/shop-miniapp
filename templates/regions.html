<!DOCTYPE html>
<html>
<head>
    <title>Выбор региона</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="header">
        <!-- Кнопка "Назад" -->
        <button id="back-button" onclick="goBack()" style="position: absolute; left: 80px; top: 50%; transform: translateY(-50%);">
            <img src="/static/back.svg" alt="Назад">
        </button>
        <img src="/static/logo22.png" alt="Логотип" class="logo">
    </div>

    <div class="content menu-vertical" id="content">
        <!-- Здесь будет динамический контент -->
    </div>

    <div class="footer-buttons">
        <button id="home-button" onclick="goHome()">
            <img src="/static/home.svg" alt="Домой">
        </button>
        <button id="login-button" onclick="auth()">
            <img src="/static/login.svg" alt="Авторизация">
        </button>
    </div>

    <!-- Кнопка корзины -->
    <div class="cart-button-container">
        <button onclick="openCart()" class="cart-button">
            <img src="/static/shop.svg" alt="Корзина">
        </button>
    </div>

    <script>
        // Глобальные переменные для хранения состояния
        let currentState = "regions";
        let currentRegion = null;
        let currentCity = null;

        // Функция для загрузки данных через API
        async function loadData(url) {
            try {
                const response = await fetch(`/api/${url}`);
                if (!response.ok) throw new Error("Ошибка загрузки данных");
                return await response.json();
            } catch (error) {
                console.error(error);
                return null;
            }
        }

        // Функция для отображения контента
        function showContent(content) {
            document.getElementById('content').innerHTML = content;
        }

        // Функция для возврата на предыдущий шаг
        function goBack() {
            if (currentState === "regions") {
                window.location.href = "/"; // Вернуться на главную страницу
            } else if (currentState === "cities") {
                showRegions();
            } else if (currentState === "stores") {
                showCities(currentRegion);
            } else if (currentState === "storeDetails") {
                showStores(currentCity, currentRegion);
            }
        }

        // Показать список областей
        async function showRegions() {
            currentState = "regions";
            const regions = await loadData('regions');
            if (regions) {
                const buttons = regions.map(region => `
                    <button onclick="showCities('${region}')">${region}</button>
                `).join('');
                showContent(`<h3>Выберите область:</h3>${buttons}`);
            }
        }

        // Показать список городов
        async function showCities(region) {
            currentState = "cities";
            currentRegion = region;
            const cities = await loadData(`cities/${region}`);
            if (cities) {
                const buttons = cities.map(city => `
                    <button onclick="showStores('${city}', '${region}')">${city}</button>
                `).join('');
                showContent(`<h3>Города в области "${region}":</h3>${buttons}`);
            }
        }

        // Показать список магазинов
        async function showStores(city, region) {
            currentState = "stores";
            currentCity = city;
            const stores = await loadData(`stores/${region}/${city}`);
            if (stores) {
                const buttons = stores.map(store => `
                    <button onclick="showStoreDetails('${store.name}')">${store.name}</button>
                `).join('');
                showContent(`<h3>Магазины в городе "${city}":</h3>${buttons}`);
            }
        }

        // Показать детали магазина
        async function showStoreDetails(storeName) {
            currentState = "storeDetails";
            const stores = await loadData(`stores/${currentRegion}/${currentCity}`);
            const store = stores.find(s => s.name === storeName);
            if (store) {
                showContent(`
                    <h3>${store.name}</h3>
                    <p><strong>Адрес:</strong> ${store.address}</p>
                    <p><strong>Режим работы:</strong> ${store.hours.replace(/\n/g, '<br>')}</p>
                    <button onclick="window.open('${store.map_url}', '_blank')">Посмотреть на карте</button>
                `);
            }
        }

        // Логика для нижнего меню
        function goHome() {
            window.location.href = "/"; // Вернуться на главную страницу
        }

        function auth() {
            alert("Функция авторизации в разработке!");
        }

        function openCart() {
            alert("Функция корзины в разработке!");
        }

        // Инициализация страницы
        window.onload = () => {
            showRegions();
        };
    </script>
</body>
</html>
